# Ruby on Rails

## Introduction

Ruby on Rails is an open source full-stack web framework built in Ruby. It's optimized for programmer happiness with Convention over Configuration (CoC) and Don't Repeat Yourself (DRY) principles.

As always, the [Documentation](http://guides.rubyonrails.org/v4.2.6/) is your best friend.

## Rails application Example

Let's say we want to create a simple blog. It will have some static pages (home, about, contact), and page with all the posts.

Users will be able to see all the posts, create a new post, edit it, and delete it.

They will also be able to see comments on posts, write comments, edit their comments and delete them as well.

### Install Rails

```sh
$ gem install rails -v 4.2.6
```

Quit and restart your terminal when it's done. On Ubuntu, run as well:

```sh
$ sudo apt-get install nodejs
```

### New App

Create a new rails application in the current folder, from the console:

```sh
$ rails new blog
```

This will create a new folder named `blog`


### Rails Directory structure

After creating the app, let's go to this folder and launch Sublime Text:

```sh
cd blog
stt
```

Rails follows the [Model-View-Controller (MVC)](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller) pattern

![MVC Architecture](http://easylara.com/wp-content/uploads/2014/11/bb8db_03.jpg)

The application code is in `/app`, for now we will focus on `app/controllers`, `app/models` and `app/views`

The other file we will care for now is `config/routes.rb` where we will describe all the application's routes.

#### Launch the Rails server

From your rails app folder (in a new console tab, preferably):

```sh
$ rails server # or, thanks to your dotfiles: rails s
```

if you go to [http://localhost:3000/](http://localhost:3000/)

you will see the rails home page:

![Rails home page image](http://blog.teamtreehouse.com/wp-content/uploads/2015/05/default-rails-home.png)

#### Launch the Rails console

The Rails console is IRB with the rails environment loaded. From your rails app folder (in a new console tab, preferably):

```sh
$ rails console # or, thanks to your dotfiles: rails c
```

:bulb: **Tips**

A few usefull commands for the rails console:

```sh
# From the rails console:
$ reload! # will reload the console with the new code you wrote
$ exit    # exit the console

# On launch:
$ rails console --sandbox # all your changes will be rolled back at exit
```

### Rails Controller

Rails integrates some generators that allow us to quickly generate classes. Let's generate a pages controller for our static pages:

```sh
$ rails generate controller pages home about contact
# create  app/controllers/pages_controller.rb
#  route  get 'pages/contact'
#  route  get 'pages/about'
#  route  get 'pages/home'
# invoke  erb
# create    app/views/pages
# create    app/views/pages/home.html.erb
# create    app/views/pages/about.html.erb
# create    app/views/pages/contact.html.erb
# ...
# < other stuff >
```

We can now navigate to those pages:

- [http://localhost:3000/pages/home](http://localhost:3000/pages/home)
- [http://localhost:3000/pages/contact](http://localhost:3000/pages/contact)
- [http://localhost:3000/pages/about](http://localhost:3000/pages/about)

The generator created

- 3 routes in `config/routes.rb`:

  ```ruby
  # config/routes.rb
  Rails.application.routes.draw do
    get 'pages/home'

    get 'pages/about'

    get 'pages/contact'
  end
  ```

- a new controller class in `app/controllers/pages_controller.rb`:

  ```ruby
  # app/controllers/pages_controller.rb
  class PagesController < ApplicationController
    def home
    end

    def about
    end

    def contact
    end
  end
  ```

- and 3 view files in `app/views/pages` like this one:

  ```erb
  <!-- app/views/pages/home.html.erb -->
  <h1>Pages#home</h1>
  <p>Find me in app/views/pages/home.html.erb</p>
  ```

At this point, you might wonder how Rails does this all magically. That is all the power of Convention over Configuration: Rails made some choices for us, if we are happy with them, we don't need to configure anything.

We can see a pattern here:

- Controller names are plural: Page**s**Controller
- The router will also route by default: `get 'pages/home'` will execute `get 'pages/home' => 'pages#home'`
- the controller will render html views by default, and will seek them in a folder with the controller name (pages) and a filename being the method name (home.html.erb)

Note: `.erb` (Embedded RuBy) will render an html file, we will understand this later.

### Modify the routes

Here is what we want:

- [http://localhost:3000/](http://localhost:3000/) should show us the home page
- [http://localhost:3000/contact](http://localhost:3000/contact) should show us the contact page
- [http://localhost:3000/about](http://localhost:3000/about) should show us the about page

We will have to modify `config/routes.rb`:

```ruby
# config/routes.rb
Rails.application.routes.draw do

  # this will give us a home page on http://localhost:3000/
  root 'pages#home'

  # For other routes, the syntax is:
  # verb 'path' => 'controller#method'
  get 'about', to: 'pages#about'
  get 'contact', to: 'pages#contact'
end
```
